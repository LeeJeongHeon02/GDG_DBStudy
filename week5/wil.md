
## week4 복습
컴퓨터의 CPU에서 L1, L2, L3 캐시가 정확하게 어떤 일을 하는건지 몰랐는데, 복습 과정에서 추가 학습을 통해 확실하게 알게되었다.
-  CPU는 -> L1 -> L2 -> L3 -> Ram -> SSD 순서대로 데이터를 찾는다. 그래서 9800X3D 같은 L캐시 용량이 큰 CPU의 게임 성능이 일반 CPU에 비해 좋은 이유를 깨달았다. 
- L캐시 용량이 크니까 게임 실행 과정에서 필요한 데이터들이 L캐시에 저장되어 있을 확률이 높고, 그만큼 RAM에서 데이터를 불러올 확률이 낮다.
- 따라서 RAM에 접근하는 횟수가 줄어듦 -> 데이터를 불러오는 레이턴시가 줄어들음 -> 프레임이 안정적이고, 높아진다.


# General Principles(일반 원칙)
- 파일 형식 설계를 시작할 때는 주소 지정 방식을 결정하는 것부터 시작한다
- > 묵시적, 즉시, 직접 간접 주소 지정 방식 이야기를 하는건가.. ?
- 파일이 동일한 크기의 페이지로 분할될지, 각 페이지가 단일/연속 블록으로 표현될지 결정한다.
	- 대부분의 In-place update storage 구조(= 데이터를 수정할 때, 새로운 공간에 저장하는것이 아닌 기존 저장 위치에 덮어쓰는 스토리지, HDD가 대표적)는 동일한 크기의 페이지를 사용한다.
		- > 데이터 접근이 예측 가능해져서 데이터의 위치를 빠르게 파악할 수 있다.
		- > 메모리를 효과적으로 할당하고 해제할 수 있어서 **단편화**를 줄일 수 있다.
	- Out of place Update : 새 위치에 새 데이터 쓰고, 포인터 갱신
		- 속도가 느리지만 안정성이 높음
		- LSM tree기반 DB, SSD 등이 있다.
## File organization

![image](https://github.com/user-attachments/assets/3de4c57e-2d0e-421c-9552-ae27c0b5f723)

**Header**
- 파일의 맨 앞, 파일의 전체 구조와 메타데이터를 담고 있음.
- 파일 형식 버전, 전체 페이지 수, 생성/수정 일자 등이 담겨있음
**Page**
- 실제 데이터 블록, 데이터를 일정 크기로 쪼개서 저장함.
**Trailer**
- 파일의 맨 끝, 무결성 검증 / 파일 마무리 정보 저장
- 파일 전체 해시값(파일 손상 여부 검증), 디지털 서명, 요약 정보 등이 포함된다.

고정 스키마 : 데이터의 구조가 사전에 정의되고 변경되지 않는 모델이다.
- 테이블이 보유할 수 있는 필드의 수, 순서 및 유형을 지정하는 역할을 한다.
- 디스크에 저장되는 데이터 양을 줄이는데 도움을 줌.

# Page Structure(페이지 구조)

- DB system은 데이터 레코드를 데이터 및 인덱스 파일에 저장한다.
- 이러한 파일들은 페이지라고 하는 고정 크기 단위로 분할된다. (일반적으로 4 ~ 16KB)

![image](https://github.com/user-attachments/assets/36900189-3406-4208-a026-4ac2a7881c22)

위 사진과 같은 고정 크기 레코드에 대한 페이지 구성에는 몇 가지 단점이 있다.
- 오른쪽이 아닌 곳에 키를 추가할 때, 재배치를 해야한다.
	- > 저번주에 배운 B tree에서 데이터를 삽입할때 재배치하는 과정을 뜻하는듯.
- 가변 크기 레코드를 효율적으로 관리하거나 액세스할 수 없다.
	- > 고정된 크기니까 당연히 가변 크기의 레코드를 효율적으로 관리할 수 없을것...

## Slotted Pages(슬롯 페이지)
: 가변 크기 레코드를 저장할때 주요 문제는 여유 공간 관리에서 발생한다.
	> 저번시간에 배운 단편화와 관련된 내용인것 같다.
	> 메모리 사이에 빈 공간이 존재해서 실제 사용 가능한 메모리가 남아있지만, 쓰지 못해서 낭비되는 경우 : **외부 단편화**
	> 실제 메모리보다 큰 공간을 할당해줘서 내부적ㅇ로 메모리가 낭비되는 경우 : **내부 단편화**

![image](https://github.com/user-attachments/assets/7bec7677-e56e-4550-ad14-9b410d7021b2)

- Page Header는 페이지 전체의 메타 정보를 가지고있다.
- Pointers에 해당하는 Slot Directory는 실제 가변 데이터가 저장된 각 레코드의 위치와 길이를 저장한다.
- Cell에 해당하는 Record Area는 실제 레코드(데이터)들이 저장되는 공간이다.


- 최소한의 낭비로 가변 크기 레코드를 저장한다.
	- > 슬롯 페이지는 오버헤드가 거의 발생하지 않는다.(Slot Directory에서 조금 발생가능)
- 제거된 레코드가 차지했던 공간을 회수한다.
	- > 전에 배운 내용처럼 삭제하려는 데이터를 '삭제됨' 상태로 두고, 추후 GC에 의해서 제거된다.
- 정확한 위치에 관계없이 페이지의 레코드를 참조한다.
	- > 데이터 슬롯은 ID(포인터값)에 의해 참조되므로 정확한 위치는 페이지 내부에 있다.

## Cell Layout(셀 레이아웃)
// 내일 계속...
